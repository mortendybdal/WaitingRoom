"use strict";angular.module("waitingRoomApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","ngAnimate-animate.css","xeditable","ngClipboard","restangular","ui.tree","ui.bootstrap","angular-loading-bar"]).config(["$routeProvider","$locationProvider","$httpProvider","cfpLoadingBarProvider",function(a,b,c,d){a.when("/",{templateUrl:"partials/frontpage",controller:"FrontpageCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["User","Editor","Admin"])}]}}).when("/patient/:step/:id",{templateUrl:"partials/patient",controller:"PatientCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["User","Editor","Admin"])}]}}).when("/builder/scheme/:id",{templateUrl:"partials/builder/scheme-builder",controller:"SchemeBuilderCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["Editor","Admin"])}]}}).when("/builder/step/:id",{templateUrl:"partials/builder/step-builder",controller:"StepBuilderCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["Editor","Admin"])}]}}).when("/builder/question/:id",{templateUrl:"partials/builder/question-builder",controller:"QuestionBuilderCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["Editor","Admin"])}]}}).when("/customers",{templateUrl:"partials/customers/clinics",controller:"ClinicsCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["Admin"])}]}}).when("/customer/clinic/:id",{templateUrl:"partials/customers/doctors",controller:"DoctorsCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["Admin"])}]}}).when("/settings",{templateUrl:"partials/settings",controller:"SettingsCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["User","Editor","Admin"])}]}}).when("/login",{templateUrl:"partials/login",controller:"LoginCtrl"}).when("/tablet/:direction/:id",{templateUrl:"partials/tablet/tablet_question",controller:"TabletQuestionCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["Tablet"])}]}}).when("/tablet/schemes",{templateUrl:"partials/tablet/tablet_scheme_list",controller:"TabletSchemeListCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["Tablet"])}]}}).when("/tablet",{templateUrl:"partials/tablet/tablet_doctor_list",controller:"TabletDoctorListCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["Tablet"])}]}}).when("/tablet/finish",{templateUrl:"partials/tablet/tablet_finish",controller:"TabletFinishCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["Tablet"])}]}}).when("/tablet/thankyou",{templateUrl:"partials/tablet/tablet_thankyou",controller:"TabletThankYouCtrl",resolve:{loggedin:["Auth",function(a){return a.isLoggedIn(["Tablet"])}]}}).otherwise({redirectTo:"/"}),b.html5Mode(!0),d.includeSpinner=!1,c.interceptors.push(["$q","$location",function(a,b){return{responseError:function(c){return 401===c.status?(b.path("/login"),a.reject(c)):a.reject(c)}}}])}]).run(["$rootScope","$location","Auth","Restangular",function(a,b,c,d){d.setBaseUrl("api"),a.$on("$routeChangeStart",function(a,d){d.authenticate&&!c.isLoggedIn()&&b.path("/login")})}]),angular.module("waitingRoomApp").controller("MainCtrl",["$scope","$rootScope","$timeout","Dictionary","Restangular","Auth",function(a,b,c,d,e,f){console.log("INit main controller"),b.response={doctor:{},questions:{},scheme:null,patient:null},b.d=d.init("da"),b.$on("event:load_start",function(){a.is_loading_content=!0}),b.$on("event:load_stop",function(){c(function(){a.is_loading_content=!1},300)}),f.roleHasAccess(["Tablet"])&&e.one("tablets").get().then(function(a){b.t=a})}]),angular.module("waitingRoomApp").controller("FrontpageCtrl",["$scope","$rootScope","$interval","Restangular",function(a,b,c,d){a.basePatients=d.all("patients"),a.basePatients.getList().then(function(c){a.patients=c,b.$broadcast("event:load_stop")}),a.calcTimeSinceSubmition=function(a){return window.moment(a).fromNow()},a.formatDateTime=function(a){return window.moment(a).format("HH:mm")}}]),angular.module("waitingRoomApp").controller("PatientCtrl",["$scope","$rootScope","$routeParams","$timeout","Restangular",function(a,b,c,d,e){function f(){c.id&&e.one("patients",c.id).get().then(function(c){c&&(a.patient=c,e.one("schemes",a.patient.Schemes[0]._id).one("patient",a.patient._id).get().then(function(c){a.questions=c,a.steps=_.sortBy(_.uniq(_.map(a.questions,"Step"),"Title"),"SortOrder"),a.setQuestions(a.steps[0]),h(),b.$broadcast("event:load_stop")}))})}function g(b){return _.sortBy(_.filter(a.questions,function(a){return a.Step._id===b._id}),"SortOrder")}function h(){var b="";_.forEach(a.steps,function(a){var c=g(a);_.forEach(c,function(a){a.JournalText&&a.Answer&&(b+=a.JournalText.replace("{{}}",a.Answer)+", "),_.forEach(a.questions,function(c){c.CorrectAnswer&&a.Answer===c.CorrectAnswer.Value&&c.JournalText&&c.Answer&&(b+=c.JournalText.replace("{{}}",c.Answer)+", ")})}),b+="\n\n"}),a.journal_text=b}a.is_copying_jounal=!1,a.is_loading_soap_widget=!1,a.baseAnswers=e.all("answers"),a.setQuestions=function(b){a.is_loading_soap_widget=!0,a.current_step=b,a.soap_item_list=g(b),d(function(){a.is_loading_soap_widget=!1},600)},a.saveAnswer=function(b){if(b){var c={AnswerText:b.Answer,Question_id:b._id,Patient_id:a.patient._id};e.one("answers").put(c),h()}},a.copyPast=function(){return a.journal_text},a.copyPastEffect=function(){a.is_copying_jounal=!0,d(function(){a.is_copying_jounal=!1},300)},a.backStep=function(){var b=_.find(a.steps,{SortOrder:a.current_step.SortOrder-1});b&&a.setQuestions(b)},a.nextStep=function(){var b=_.find(a.steps,{SortOrder:a.current_step.SortOrder+1});b&&a.setQuestions(b)},f()}]),angular.module("waitingRoomApp").controller("TabletCtrl",["$scope","$rootScope","$timeout","Restangular",function(a,b,c,d){function e(){var b=[],c=0;_.forEach(a.questions,function(b){if(console.log("Clean out procedure",b),b&&b.ParentQuestion){var c=_.find(a.questions,function(a){return a._id===b.ParentQuestion});c.Answer&&c.Answer!==b.CorrectAnswer.Value&&_.remove(a.questions,function(a){return a._id===b._id})}}),_.forEach(_.sortBy(a.questions,"SortOrder"),function(d){d.SortOrder=c,c++,b.push(d),_.forEach(_.sortBy(d.questions,"SortOrder"),function(e){e.CorrectAnswer&&d.Answer&&d.Answer===e.CorrectAnswer.Value&&d._id!==e._id&&(_.find(a.questions,function(a){return a._id===e._id})||(e.SortOrder=c,c++,b.push(e)))})}),a.questions=b}b.hide_navigation_menu=!0,a.index=-1,a.direction="left",a.scheme_type="none",a.baseSchemes=d.all("schemes"),a.basePatients=d.all("patients"),a.baseAnswers=d.all("answers"),a.baseSchemes.getList().then(function(d){a.schemes=d,c(function(){b.$broadcast("event:load_stop")})}),a.nextSlide=function(b){if(b){e();var d={AnswerText:b.Answer,Question_id:b._id,Patient_id:a.patient._id};a.baseAnswers.post(d).then(function(){console.log("Object saved OK")},function(){console.log("There was an error saving")})}c(function(){a.index++,a.direction="left"},0)},a.backSlide=function(){a.index--,a.direction="right"},a.finishQuestionary=function(){a.nextSlide()},a.createPatient=function(b){a.questions=_.find(b.steps,{SortOrder:0}).questions,a.nextSlide(),a.basePatients.post().then(function(c){a.patient=c,c.Schemes.push(b._id),c.save()})},a.getNumberOfSlidesShown=function(a){return a.length<4?a.length:3}}]),angular.module("waitingRoomApp").controller("LoginCtrl",["$scope","$rootScope","Auth","$location",function(a,b,c,d){a.user={},a.errors={},a.login=function(e){a.submitted=!0,e.$valid&&c.login({email:a.user.email,password:a.user.password}).then(function(){b.$broadcast("event:update_content_tree"),console.log(b.currentUser),d.path("Tablet"!==b.currentUser.role?"/":"/tablet")}).catch(function(b){b=b.data,a.errors.other=b.message})},a.onKeyPressed=function(b,c){13===c.keyCode&&a.login(b)}}]),angular.module("waitingRoomApp").controller("SignupCtrl",["$scope","$rootScope","Auth","$location",function(a,b,c,d){b.$broadcast("event:load_stop"),a.user={},a.errors={},a.register=function(b){a.submitted=!0,b.$valid&&c.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){d.path("/")}).catch(function(c){c=c.data,a.errors={},angular.forEach(c.errors,function(c,d){b[d].$setValidity("mongoose",!1),a.errors[d]=c.message})})}}]),angular.module("waitingRoomApp").controller("NavigationCtrl",["$scope","$rootScope","$location","$modal","$timeout","Auth",function(a,b,c,d,e,f){a.auth=f,a.showContentTree=function(){a.show_content_tree=!a.show_content_tree},a.hideContentTree=function(){console.log("Hide"),a.show_content_tree=!1},a.logout=function(){f.logout().then(function(){c.path("/login")})}}]),angular.module("waitingRoomApp").controller("SettingsCtrl",["$scope","$rootScope","User","Auth",function(a,b,c,d){b.$broadcast("event:load_stop"),a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&d.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."}).catch(function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password"})}}]),angular.module("waitingRoomApp").controller("SchemeBuilderCtrl",["$scope","$rootScope","$routeParams","$modal","$location","Restangular",function(a,b,c,d,e,f){c.id&&f.one("schemes",c.id).get().then(function(c){a.scheme=c,b.$broadcast("event:load_stop")}),a.save=function(c){a.submitted=!0,c.$valid&&(a.updating_scheme=!0,a.scheme.save().then(function(){a.updating_scheme=!1,b.$broadcast("event:update_content_tree")}))},a.openModal=function(a,b,c){d.open({templateUrl:"partials/modals/create-modal.html",controller:["$scope","$modalInstance","ModalService",function(d,e,f){d.ModalService=f.init(e),d.type=a,d.title=b,d.parent_id=c}]})}}]),angular.module("waitingRoomApp").controller("StepBuilderCtrl",["$scope","$rootScope","$routeParams","$modal","$location","Restangular",function(a,b,c,d,e,f){c.id&&f.one("steps",c.id).get().then(function(c){a.step=c,b.$broadcast("event:load_stop")}),a.save=function(c){a.submitted=!0,c.$valid&&(a.updating_step=!0,a.step.save().then(function(){a.updating_step=!1,b.$broadcast("event:update_content_tree")}))},a.openModal=function(a,b,c){d.open({templateUrl:"partials/modals/create-modal.html",controller:["$scope","$modalInstance","ModalService",function(d,e,f){d.ModalService=f.init(e),d.type=a,d.title=b,d.parent_id=c}]})}}]),angular.module("waitingRoomApp").controller("QuestionBuilderCtrl",["$scope","$rootScope","$routeParams","$modal","$location","Restangular",function(a,b,c,d,e,f){function g(){var b,c;b="......"===a.journal_prefix||"&#8203"===a.journal_prefix?"":a.journal_prefix,c="......"===a.journal_suffix||"&#8203"===a.journal_suffix?"":a.journal_suffix;var d=b+" {{}} "+c;return d.replace(/&nbsp;/g,"")}function h(b){if(b){var c=b.split("{{}}");console.log(c[0]),a.journal_prefix=c[0]?c[0]:"......",console.log(c[1]),a.journal_suffix=c[1]?c[1]:"......"}}a.options=[{Label:"Single Text",Value:"single-text"},{Label:"Multi Text",Value:"multi-text"},{Label:"Radio List",Value:"radio-list"},{Label:"Select List",Value:"select-list"}],a.journal_prefix="......",a.journal_suffix="......",c.id&&f.one("questions",c.id).get().then(function(c){a.question=c,a.question.Type=_.find(a.options,a.question.Type),a.question.ParentQuestion&&a.question.ParentQuestion.Options&&a.question.CorrectAnswer&&(a.question.CorrectAnswer=_.find(a.question.ParentQuestion.Options,a.question.CorrectAnswer)),h(a.question.JournalText),b.$broadcast("event:load_stop")}),a.save=function(c){a.submitted=!0,console.log(c),c.$valid&&(a.updating_question=!0,_.remove(a.question.Options,function(a){return""===a.Value&&""===a.Key}),a.question.JournalText=g(),a.question.save().then(function(){a.updating_question=!1,b.$broadcast("event:update_content_tree")}))},a.openModal=function(a,b,c){d.open({templateUrl:"partials/modals/create-modal.html",controller:["$scope","$modalInstance","ModalService",function(d,e,f){d.ModalService=f.init(e),d.type=a,d.title=b,d.parent_id=c}]})},a.addOption=function(){var b={Key:"",Value:""};a.question.Options.push(b)},a.prefixFocus=function(){"......"===a.journal_prefix&&(a.journal_prefix="&#8203")},a.prefixBlur=function(){("&#8203"===a.journal_prefix||""===a.journal_prefix)&&(a.journal_prefix="......")},a.suffixFocus=function(){"......"===a.journal_suffix&&(a.journal_suffix="&#8203")},a.suffixBlur=function(){("&#8203"===a.journal_suffix||""===a.journal_suffix)&&(a.journal_suffix="......")}}]),angular.module("waitingRoomApp").controller("NavigationBuilderCtrl",["$scope","$rootScope","$modal","Restangular","Auth",function(a,b,c,d,e){e.roleHasAccess(["Editor","Admin"])&&(a.baseSchemes=d.all("schemes"),a.expanded_items=[],a.baseSchemes.getList().then(function(b){a.schemes=b}),a.expandContentTree=function(b){_.contains(a.expanded_items,b._id)?_.remove(a.expanded_items,function(a){return a===b._id}):a.expanded_items.push(b._id)},a.contentItemIsOpen=function(b){return _.contains(a.expanded_items,b._id)},b.$on("event:update_content_tree",function(){a.baseSchemes.getList().then(function(b){a.schemes=b,console.log("Updating content....")})}),a.$on("$routeChangeStart",function(){a.hideContentTree()}),a.content_tree={accept:function(a,b){return a.depth()===b.depth()+1&&b.isParent(a)},dropped:function(a){var b=a.dest.nodesScope,c=b.$element.attr("data-type"),e=b.$modelValue;_.forEach(e,function(a,b){d.one(c,a._id).get().then(function(a){a.SortOrder=b,a.save()})})}},a.openModal=function(a,b,d){console.log(name),c.open({templateUrl:"partials/modals/create-modal.html",controller:["$scope","$modalInstance","ModalService",function(c,e,f){c.ModalService=f.init(e),c.type=a,c.title=b,c.parent_id=d}]})},a.openDeleteModal=function(a,b,d,e){c.open({templateUrl:"partials/modals/delete-modal.html",controller:["$scope","$modalInstance","ModalService",function(c,f,g){c.ModalService=g.init(f),c.type=a,c.title=b,c.name=d,c.item_id=e}]})})}]),angular.module("waitingRoomApp").controller("ClinicsCtrl",["$scope","$rootScope","$modal","Restangular",function(a,b,c,d){function e(){a.baseClinics.getList().then(function(c){a.clinics=c,b.$broadcast("event:load_stop")})}a.baseClinics=d.all("clinics"),a.clinics=[],a.openModal=function(){c.open({templateUrl:"partials/modals/create-clinic-modal.html",controller:["$scope","$modalInstance","clinics",function(a,b,c){console.log(a),a.save=function(e,f){a.is_submitted=!0,e.$valid&&(a.is_loading=!0,d.all("clinics").post(f).then(function(d){a.is_loading=!1,a.is_submitted=!1,c.push(d),b.close()},function(){console.log("Error occured when creating new customer")}))},a.close=function(){b.close()}}],resolve:{clinics:function(){return a.clinics}}})},e()}]),angular.module("waitingRoomApp").controller("DoctorsCtrl",["$scope","$rootScope","$routeParams","$modal","Restangular",function(a,b,c,d,e){function f(){c.id&&(e.one("clinics",c.id).get().then(function(c){a.clinic=c,console.log(a.clinic),b.$broadcast("event:load_stop")}),e.one("clinics",c.id).getList("users").then(function(b){a.users=b,console.log(a.users)}))}a.roles=["Admin","Editor","User","Tablet"],a.current_selected_doctor=null,a.openModal=function(){d.open({templateUrl:"partials/modals/create-doctor-modal.html",controller:["$scope","$modalInstance","users","roles",function(a,b,d,f){a.roles=f,a.save=function(f,g){a.is_submitted=!0,console.log(f),f.$valid&&(a.is_loading=!0,g.clinic=c.id,e.all("users").post(g).then(function(c){a.is_loading=!1,a.is_submitted=!1,d.push(c),b.close()},function(){console.log("Error occured when creating new customer")}))},a.close=function(){b.close()}}],resolve:{users:function(){return a.users},roles:function(){return a.roles}}})},a.save=function(b,c){a.submitted=!0,b.$valid&&(a.updating_user=!0,console.log(c),c.put().then(function(){a.updating_user=!1}))},a.openDeleteModal=function(b){d.open({templateUrl:"partials/modals/delete-doctor-modal.html",controller:["$scope","$modalInstance","users",function(a,c,d){a.user=b,a.delete=function(b){a.is_loading=!0,e.one("Users",b._id).remove().then(function(){a.is_loading=!1,_.remove(d,function(a){return a._id===b._id}),c.close()})},a.close=function(){c.close()}}],resolve:{users:function(){return a.users}}})},a.openDeleteClinicModal=function(a){d.open({templateUrl:"partials/modals/delete-clinic-modal.html",controller:["$scope","$modalInstance","$location",function(b,c,d){b.clinic=a,b.delete=function(a){b.is_loading=!0,e.one("Clinics",a).remove().then(function(){b.is_loading=!1,c.close(),d.path("/customers")})},b.close=function(){c.close()}}]})},a.collapsUser=function(b){a.current_selected_doctor=a.current_selected_doctor!==b?b:null},f()}]),angular.module("waitingRoomApp").controller("TabletQuestionCtrl",["$scope","$rootScope","$routeParams","$location",function(a,b,c,d){function e(){var c=_.find(b.response.questions,function(c){if(c.SortOrder>a.question.SortOrder){if(!c.ParentQuestion)return!0;if(c.CorrectAnswer){var d=_.find(b.response.questions,{_id:c.ParentQuestion});if(c.CorrectAnswer.Value===d.Answer)return!0}}});c?d.path("tablet/next/"+c._id):(console.log("GO TO FINISH PAGE"),d.path("/tablet/finish"))}function f(){var c=_.clone(b.response.questions).reverse(),e=_.find(c,function(c){if(c.SortOrder<a.question.SortOrder){if(!c.ParentQuestion)return!0;if(c.CorrectAnswer){var d=_.find(b.response.questions,{_id:c.ParentQuestion});if(c.CorrectAnswer.Value===d.Answer)return!0}}});d.path(e?"tablet/previous/"+e._id:"tablet/schemes")}function g(b){a.question=_.find(b,{_id:c.id}),a.question||d.path("tablet")}function h(){"next"===c.direction&&(a.page_class="page-slide-up"),"previous"===c.direction&&(a.page_class="page-slide-down")}function i(){c.id&&(b.response.questions?(h(b.response.questions),g(b.response.questions)):d.path("tablet"))}b.tablet_ui=!0,b.$broadcast("event:load_stop"),a.nextSlide=function(){e()},a.backSlide=function(){f()},a.onKeyPressed=function(a){13===a.keyCode&&e()},i()}]),angular.module("waitingRoomApp").controller("TabletSchemeListCtrl",["$scope","$rootScope","$location",function(a,b,c){function d(a){var b=_.sortBy(_.find(a.steps,{SortOrder:0}).questions,"SortOrder"),c=[],d=0;return _.forEach(b,function(a){a.SortOrder=d,c.push(a),d++,_.forEach(_.sortBy(a.questions,"SortOrder"),function(a){a.SortOrder=d,c.push(a),d++})}),c}b.tablet_ui=!0,b.$broadcast("event:load_stop"),a.page_class="page-slide-up",a.selectScheme=function(a){var e=_.cloneDeep(a);b.response.questions=d(e),b.response.scheme=a._id;var f=_.find(b.response.questions,{SortOrder:0});c.path("tablet/next/"+f._id)}}]),angular.module("waitingRoomApp").controller("TabletDoctorListCtrl",["$scope","$rootScope","$location","Auth",function(a,b,c,d){return d.roleHasAccess(["Tablet"])?(b.tablet_ui=!0,b.$broadcast("event:load_stop"),a.page_class="page-slide-up",void(a.selectDoctor=function(a){b.response.doctor=a,c.path("tablet/schemes")})):void c.path("/")}]),angular.module("waitingRoomApp").controller("TabletFinishCtrl",["$scope","$rootScope","$location","Restangular",function(a,b,c,d){function e(a){var c=[];return _.forEach(b.response.questions,function(b){if(b.Answer){var d={};d.AnswerText=b.Answer,d.Question_id=b._id,d.Patient_id=a,c.push(d)}}),c}a.basePatients=d.all("patients"),a.baseAnswers=d.all("answers"),a.is_loading=!1,b.tablet_ui=!0,b.$broadcast("event:load_stop"),a.page_class="page-slide-up",b.response.doctor.name||c.path("tablet"),a.sendAnswersToDoctor=function(){a.is_loading=!0,b.response.scheme&&b.response.doctor?a.basePatients.post({Doctor:b.response.doctor._id}).then(function(d){b.response.patient=d._id,d.Schemes.push(b.response.scheme),d.save();var f=e(d._id);f.length>0&&a.baseAnswers.post(f).then(function(){c.path("tablet/thankyou")})}):console.error("Scheme id is not set on rootScope.")}}]),angular.module("waitingRoomApp").controller("TabletThankYouCtrl",["$scope","$rootScope","$interval","$location",function(a,b,c,d){function e(){b.response={doctor:{},questions:{},scheme:null,patient:null}}function f(){a.reset_timer=c(function(){0===a.reset_clock?(c.cancel(a.reset_timer),e(),d.path("tablet")):a.reset_clock--},1e3)}b.tablet_ui=!0,b.$broadcast("event:load_stop"),a.reset_clock=10,a.page_class="page-slide-up",f()}]),angular.module("waitingRoomApp").controller("TabletNavigationCtrl",["$scope","$location","$rootScope",function(a,b,c){function d(){c.response={doctor:{},questions:{},scheme:null,patient:null}}a.tablet_navigation_expanded=!1,a.onClickHome=function(){d(),a.tablet_navigation_expanded=!1,b.path("/tablet/")}}]),angular.module("waitingRoomApp").directive("offClick",["$document",function(a){function b(a,b){if(!a||!b)return!1;for(var c=angular.element(b),d=c.length,e=0;d>e;++e)if(c[e].contains(a))return!0;return!1}return{restrict:"A",scope:{offClick:"&",offClickIf:"&"},link:function(c,d,e){function f(a){var f=a.target||a.srcElement;d[0].contains(f)||b(f,e.offClickFilter)||c.$apply(c.offClick())}e.offClickIf?c.$watch(c.offClickIf,function(b,c){b&&!c?a.on("click",f):b||a.off("click",f)}):a.on("click",f)}}}]),angular.module("waitingRoomApp").directive("contenteditable",["$timeout",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){if(e){var f={};angular.forEach(["stripBr","noLineBreaks","selectNonEditable","moveCaretToEndOnChange"],function(a){var b=d[a];f[a]=b&&"false"!==b}),c.bind("input",function(){b.$apply(function(){var b,d,g;b=c.html(),g=!1,f.stripBr&&(b=b.replace(/<br>$/,"")),f.noLineBreaks&&(d=b.replace(/<div>/g,"").replace(/<br>/g,"").replace(/<\/div>/g,""),d!==b&&(g=!0,b=d)),e.$setViewValue(b),g&&e.$render(),""===b&&a(function(){c[0].blur(),c[0].focus()})})});var g=e.$render;e.$render=function(){var a,b,d,h;g&&g(),c.html(e.$viewValue||""),f.moveCaretToEndOnChange&&(a=c[0],d=document.createRange(),h=window.getSelection(),a.childNodes.length>0?(b=a.childNodes[a.childNodes.length-1],d.setStartAfter(b)):d.setStartAfter(a),d.collapse(!0),h.removeAllRanges(),h.addRange(d))},f.selectNonEditable&&c.bind("click",function(a){var b,c,d;d=a.toElement,d!==this&&"false"===angular.element(d).attr("contenteditable")&&(b=document.createRange(),c=window.getSelection(),b.setStartBefore(d),b.setEndAfter(d),c.removeAllRanges(),c.addRange(b))})}}}}]),angular.module("waitingRoomApp").factory("ModalService",["$rootScope","$timeout","$location","Restangular",function(a,b,c,d){function e(b){var e={};e.Title=b,d.all("schemes").post(e).then(function(b){l.is_loading=!1,l.is_submitted=!1,l.modal_instance.close(),a.$broadcast("event:update_content_tree"),c.path("builder/scheme/"+b._id)},function(){console.log("Error occured when creating new scheme")})}function f(b,e){var f={};f.Title=b,f.Scheme_id=e,d.all("steps").post(f).then(function(b){l.is_loading=!1,l.is_submitted=!1,l.modal_instance.close(),a.$broadcast("event:update_content_tree"),c.path("builder/step/"+b._id)},function(){console.log("Error occured when creating new scheme")})}function g(b,e){var f={};f.QuestionText=b,f.Step=e,d.all("questions").post(f).then(function(b){l.is_loading=!1,l.is_submitted=!1,l.modal_instance.close(),a.$broadcast("event:update_content_tree"),c.path("builder/question/"+b._id)},function(){console.log("Error occured when creating new scheme")})}function h(b,e){var f={};f.QuestionText=b,f.ParentQuestion=e,d.all("questions").post(f).then(function(b){l.is_loading=!1,l.is_submitted=!1,l.modal_instance.close(),a.$broadcast("event:update_content_tree"),c.path("builder/question/"+b._id)},function(){console.log("Error occured when creating new scheme")})}function i(b){d.one("Schemes",b).remove().then(function(){l.is_loading=!1,l.is_submitted=!1,l.modal_instance.close(),a.$broadcast("event:update_content_tree")})}function j(b){d.one("Steps",b).remove().then(function(){l.is_loading=!1,l.is_submitted=!1,l.modal_instance.close(),a.$broadcast("event:update_content_tree")})}function k(b){d.one("Questions",b).remove().then(function(){l.is_loading=!1,l.is_submitted=!1,l.modal_instance.close(),a.$broadcast("event:update_content_tree")})}var l=this;return l.is_loading=!1,l.is_submitted=!1,l.modal_instance={},{init:function(a){return l.modal_instance=a,this},isLoading:function(){return l.is_loading},isSubmitted:function(){return l.is_submitted},save:function(a,b,c,d){if(!l.modal_instance)throw"Service has not been iniziated with a modal scope";if(l.is_submitted=!0,a.$valid)switch(l.is_loading=!0,b){case"Scheme":e(d);break;case"Step":f(d,c);break;case"Question":g(d,c);break;case"Subquestion":h(d,c);break;default:throw"The content type "+b+"is not recoqnized."}},"delete":function(a,b){if(!l.modal_instance)throw"Service has not been iniziated with a modal scope";switch(l.is_submitted=!0,l.is_loading=!0,a){case"Scheme":i(b);break;case"Step":j(b);break;case"Question":k(b);break;default:throw"The content type "+a+"is not recoqnized."}},close:function(){l.modal_instance.close()}}}]),angular.module("waitingRoomApp").factory("Auth",["$location","$rootScope","$cookieStore","$http","$timeout","$q","Session","User",function(a,b,c,d,e,f,g,h){return b.currentUser=c.get("user")||null,c.remove("user"),{login:function(a,c){var d=c||angular.noop;return g.save({email:a.email,password:a.password},function(a){return b.currentUser=a,d()},function(a){return d(a)}).$promise},logout:function(a){var c=a||angular.noop;return g.delete(function(){return b.currentUser=null,b.is_logged_in=!1,c()},function(a){return c(a)}).$promise},createUser:function(a,c){var d=c||angular.noop;return h.save(a,function(a){return b.currentUser=a,d(a)},function(a){return d(a)}).$promise},changePassword:function(a,b,c){var d=c||angular.noop;return h.update({oldPassword:a,newPassword:b},function(a){return d(a)},function(a){return d(a)}).$promise},currentUser:function(){return h.get()},isLoggedIn:function(c){var d=b.currentUser;return d?(c&&!_.contains(c,d.role)&&a.url("Tablet"===d.role?"/tablet":"/"),b.is_logged_in=!0):(b.is_logged_in=!1,a.url("/login")),!!d},roleHasAccess:function(a){return b.currentUser&&_.contains(a,b.currentUser.role)}}}]),angular.module("waitingRoomApp").factory("Session",["$resource",function(a){return a("/api/session/")}]),angular.module("waitingRoomApp").factory("User",["$resource",function(a){return a("/api/users/:id",{id:"@id"},{update:{method:"PUT",params:{}},get:{method:"GET",params:{id:"me"}}})}]),angular.module("waitingRoomApp").factory("Dictionary",function(){var a=[{key:"GENERAL_CompanyName",values:[{value:"DokHop",language:"da"},{value:"DocHub",language:"en"}]},{key:"GENERAL_Title",values:[{value:"Titel",language:"da"},{value:"Title",language:"en"}]},{key:"GENERAL_EnterTitle",values:[{value:"Indtast en titel",language:"da"},{value:"Please enter a title",language:"en"}]},{key:"GENERAL_Doctor",values:[{value:"Læge",language:"da"},{value:"Doctor",language:"en"}]},{key:"GENERAL_Role",values:[{value:"Rolle",language:"da"},{value:"Role",language:"en"}]},{key:"GENERAL_Name",values:[{value:"Navn",language:"da"},{value:"Name",language:"en"}]},{key:"GENERAL_Cancel",values:[{value:"Annuller",language:"da"},{value:"Cancel",language:"en"}]},{key:"GENERAL_Username",values:[{value:"Brugernavn (email)",language:"da"},{value:"Username (email)",language:"en"}]},{key:"GENERAL_Password",values:[{value:"Kodeord",language:"da"},{value:"Password",language:"en"}]},{key:"GENERAL_Create",values:[{value:"Opret",language:"da"},{value:"Create",language:"en"}]},{key:"GENERAL_Step",values:[{value:"trin",language:"da"},{value:"Step",language:"en"}]},{key:"GENERAL_Question",values:[{value:"spørgsmål",language:"da"},{value:"Question",language:"en"}]},{key:"GENERAL_SubQuestion",values:[{value:"underspørgsmål",language:"da"},{value:"Subquestion",language:"en"}]},{key:"GENERAL_Scheme",values:[{value:"spørgeskema",language:"da"},{value:"Scheme",language:"en"}]},{key:"GENERAL_Delete",values:[{value:"Slet",language:"da"},{value:"Delete",language:"en"}]},{key:"TABLET_PleaseChooseScheme",values:[{value:"Vælg et skema",language:"da"},{value:"Please choose scheme",language:"en"}]},{key:"TABLET_PleaseComplete",values:[{value:"Afslut skemaet",language:"da"},{value:"Please complete the questionary.",language:"en"}]},{key:"TABLET_Finish",values:[{value:"Afslut",language:"da"},{value:"Finish.",language:"en"}]},{key:"TABLET_AnswerHasBeenSend",values:[{value:"Dit svar er blevet send til din læge",language:"da"},{value:"Your answers har been send to you doctor..",language:"en"}]},{key:"TABLET_ThankYou",values:[{value:"Tak for dine svar!",language:"da"},{value:"Thank you!",language:"en"}]},{key:"PATIENT_Question",values:[{value:"Spørgsmål",language:"da"},{value:"Question",language:"en"}]},{key:"PATIENT_Answer",values:[{value:"Svar",language:"da"},{value:"Answer",language:"en"}]},{key:"PATIENT_Empty",values:[{value:"Intet svar",language:"da"},{value:"Empty",language:"en"}]},{key:"PATIENT_Back",values:[{value:"Forrige",language:"da"},{value:"Back",language:"en"}]},{key:"PATIENT_Next",values:[{value:"Næste",language:"da"},{value:"Next",language:"en"}]},{key:"PATIENT_Copying",values:[{value:"Kopierer...",language:"da"},{value:"Copying...",language:"en"}]},{key:"PATIENT_Description",values:[{value:"Beskrivelse",language:"da"},{value:"Description",language:"en"}]},{key:"PATIENT_CopyPast",values:[{value:"Beskrivelse",language:"da"},{value:"Description",language:"en"}]},{key:"NAVIGATION_CreateScheme",values:[{value:"Opret sprørgeskema",language:"da"},{value:"Create Scheme",language:"en"}]},{key:"LOGIN_Email",values:[{value:"Email",language:"da"},{value:"Email",language:"en"}]},{key:"LOGIN_Password",values:[{value:"Kodeord",language:"da"},{value:"Password",language:"en"}]},{key:"LOGIN_PleaseEnter",values:[{value:"Indstast din emailadresse og dit kodeord",language:"da"},{value:"Please enter your email and password.",language:"en"}]},{key:"LOGIN_SignIn",values:[{value:"Log in",language:"da"},{value:"Sign In",language:"en"}]},{key:"FRONTPAGE_Scheme",values:[{value:"Spørgeskema",language:"da"},{value:"Scheme",language:"en"}]},{key:"FRONTPAGE_TimeForAppointment",values:[{value:"Tid for konsultation",language:"da"},{value:"Time for appointment",language:"en"}]},{key:"FRONTPAGE_Submitted",values:[{value:"Tid for indsendelse",language:"da"},{value:"Submitted",language:"en"}]},{key:"QuestionBuilder_AddSubQuestion",values:[{value:"Opret underspørgsmål",language:"da"},{value:"Add Subquestion",language:"en"}]},{key:"QuestionBuilder_EnterQuestion",values:[{value:"Indtast et spørgsmål.",language:"da"},{value:"Please enter a question.",language:"en"}]},{key:"QuestionBuilder_EnterQuestionType",values:[{value:"Indtast et spørgsmåltype.",language:"da"},{value:"Please enter a question type.",language:"en"}]},{key:"QuestionBuilder_JournalText",values:[{value:"Journal tekst",language:"da"},{value:"JounalText",language:"en"}]},{key:"QuestionBuilder_Answer",values:[{value:"Svar",language:"da"},{value:"Answer",language:"en"}]},{key:"QuestionBuilder_Option",values:[{value:"Svarmuligheder",language:"da"},{value:"Option",language:"en"}]},{key:"QuestionBuilder_AddOption",values:[{value:"Tilføj svarmulighed",language:"da"},{value:"Add Option",language:"en"}]},{key:"QuestionBuilder_Type",values:[{value:"Spørgsmålstype",language:"da"},{value:"Type",language:"en"}]},{key:"QuestionBuilder_Question",values:[{value:"Spørgsmål",language:"da"},{value:"Question",language:"en"}]},{key:"QuestionBuilder_CorrectParentAnswer",values:[{value:"Svar på hovedspørgsmål",language:"da"},{value:"Answer to parent question",language:"en"}]},{key:"QuestionBuilder_CorrectParentAnswerValidationText",values:[{value:"Vælg det svar hvad der skal være det korrekte svar tilhovedspørgsmålet for at dette spørgsmål vises",language:"da"},{value:"Please select an answer that should be resolved for this question to be shown.",language:"en"}]},{key:"QuestionBuilder_SaveQuestion",values:[{value:"Gem Spørgsmål",language:"da"},{value:"Save Question",language:"en"}]},{key:"SchemeBuilder_AddStep",values:[{value:"Tilføj trin",language:"da"},{value:"Add Step",language:"en"}]},{key:"SchemeBuilder_SaveScheme",values:[{value:"Gem Spørgeskema",language:"da"},{value:"Save scheme",language:"en"}]},{key:"StepBuilder_SaveStep",values:[{value:"Gem trin",language:"da"},{value:"Save Step",language:"en"}]},{key:"StepBuilder_AddQuestion",values:[{value:"Tilføj spørgsmål",language:"da"},{value:"Add question",language:"en"}]},{key:"CLINIC_AddClinic",values:[{value:"Tilføj klinik",language:"da"},{value:"Add Clinic",language:"en"}]},{key:"CLINIC_CustomerOverview",values:[{value:"Kunde oversigt",language:"da"},{value:"Customer Overview",language:"en"}]},{key:"CLINIC_Clinic",values:[{value:"Klinik",language:"da"},{value:"Clinic",language:"en"}]},{key:"CLINIC_Doctor",values:[{value:"Læge",language:"da"},{value:"Doctor",language:"en"}]},{key:"DOCTOR_AddDoctor",values:[{value:"Tilføj Læge",language:"da"},{value:"Add Doctor",language:"en"}]},{key:"DOCTOR_DeleteClinic",values:[{value:"Slet Klinik",language:"da"},{value:"Delete Clinic",language:"en"}]},{key:"DOCTOR_DoctorsOverview",values:[{value:"Læge oversigt",language:"da"},{value:"Doctors Overview",language:"en"}]},{key:"DOCTOR_EnterName",values:[{value:"Indtast et navn",language:"da"},{value:"Please enter a name",language:"en"}]},{key:"DOCTOR_EnterRole",values:[{value:"Vælg en rolle",language:"da"},{value:"Please choose a role",language:"en"}]},{key:"DOCTOR_SaveDoctor",values:[{value:"Gem læge",language:"da"},{value:"Save Doctor",language:"en"}]},{key:"DOCTOR_DeleteDoctor",values:[{value:"Slet læge",language:"da"},{value:"Delete Doctor",language:"en"}]},{key:"MODAL_CreateClinic",values:[{value:"Opret klinik",language:"da"},{value:"Create Clinic",language:"en"}]},{key:"MODAL_EnterClinicName",values:[{value:"Indtast navnet på kliniken",language:"da"},{value:"Please enter a clinic name",language:"en"}]},{key:"MODAL_CreateDoctor",values:[{value:"Opret læge",language:"da"},{value:"Create Doctor",language:"en"}]},{key:"MODAL_EnterName",values:[{value:"Indtast et navn",language:"da"},{value:"Please enter a name",language:"en"}]},{key:"MODAL_EnterRole",values:[{value:"Vælg en rolle",language:"da"},{value:"Please choose a role",language:"en"}]},{key:"MODAL_EnterEmail",values:[{value:"Indtast en valid email adresse",language:"da"},{value:"Please enter a valid email",language:"en"}]},{key:"MODAL_EnterPassword",values:[{value:"Indtast et kodeord",language:"da"},{value:"Please enter a password",language:"en"}]},{key:"MODAL_EnterTitleFor",values:[{value:"Indtast titel for",language:"da"},{value:"Please enter a title for",language:"en"}]},{key:"MODAL_AreYouSure",values:[{value:"Er du sikker på du ønsker at slette: ",language:"da"},{value:"Are you sure you want to delete: ",language:"en"}]},{key:"MODAL_AndAllSubitems",values:[{value:"- Og alle underelementer?",language:"da"},{value:"- And all subitems?: ",language:"en"}]},{key:"MODAL_AndAllDoctors",values:[{value:"- Og alle de tilhørende læger?",language:"da"},{value:"- And all its doctors?: ",language:"en"}]}];
return{init:function(b){var c={};return _.forEach(a,function(a){c[a.key]=_.find(a.values,function(a){return a.language===b?a:void 0}).value}),c}}}),angular.module("waitingRoomApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}});